import{k as O,a as s,c as a,m as ne,d as I,l as S,f as t,i as p,I as le,F as h,J as D,x as f,h as N,K as Z,w as ae,r as y,o as K,q as ie,L as U,t as A,e as x,b as $,j as C,B as ee,u as g,g as W,M as V,N as J,O as q,T as F,v as G,P as j,Q as re,R as ce,n as te,V as P,W as ue,X as de,p as pe,Y as _e,Z as fe,C as me}from"./index-WLcRglgj.js";import{B as X}from"./BannerDeviceCanarytools-WApAaFA_.js";const he={},ye={class:"grid two-col-grid"};function ge(e,o){return s(),a("div",ye,[ne(e.$slots,"default")])}const ve=O(he,[["render",ge]]),xe={class:"w-full @container"},be={class:"flex flex-row items-center flex-1 gap-16"},ke={class:"text-left"},we={class:"capitalize text-grey-400"},$e={class:"mr-8 font-semibold"},Te={class:"flex flex-row items-center justify-end gap-8 mt-8 font-semibold text-red sm:hidden"},Ce=I({__name:"CardIncident",props:{lastKey:{type:Boolean},incidentPreviewInfo:{},incidentId:{}},emits:["click"],setup(e,{emit:o}){const l=o;function r(){l("click")}return(i,_)=>{const d=S("font-awesome-icon");return s(),a("li",xe,[t("button",Z(i.$attrs,{class:["relative w-full px-16 py-8 transition duration-100 bg-white border text-grey-700 grouped group rounded-xl shadow-solid-shadow-grey border-grey-200 error-card",{"mb-8":i.lastKey}],onClick:ae(r,["stop"])}),[t("span",be,[p(le,{class:"hidden @xs:block min-w-[30px] group-hover:fill-red group-focus:fill-red group-active:fill-red fill-grey-700 group-hover:scale-95 transition duration-200","aria-hidden":"true"}),t("span",ke,[(s(!0),a(h,null,D(i.incidentPreviewInfo,(c,m)=>(s(),a("span",{key:m,class:"block"},[t("span",we,f(m)+": ",1),t("span",$e,f(c),1)]))),128))])]),t("span",Te,[N("Check Incident "),p(d,{icon:"arrow-right",class:"text-red","aria-hidden":"true"})])],16)])}}}),Ie=O(Ce,[["__scopeId","data-v-f1b543ed"]]),Le={key:0},Se={key:1,class:"placeholder"},De={class:"font-medium"},Me={class:"pb-8"},Be={class:"font-medium"},Ee={class:"pt-8"},Ne=I({__name:"CustomMap",props:{hitsList:{}},setup(e){const o=e,l=y(!0),r=y(),i=y(),_=y({lat:0,lng:0});function d(n){const u=n.split(",");return{lat:parseFloat(u[0]),lng:parseFloat(u[1])}}K(()=>{if(o.hitsList.length!==0){if(o.hitsList.length>1)return L();o.hitsList.length===1&&(_.value=d(o.hitsList[0].geo_info.loc))}});const c=ie(()=>o.hitsList.map(n=>({id:n.time_of_hit,ip:n.geo_info.ip,hostname:n.geo_info.hostname,city:n.geo_info.city,country:n.geo_info.country,date:U(n.time_of_hit),position:n.geo_info.loc?d(n.geo_info.loc):void 0})));function m(n){r.value=n}async function L(){const n=await i.value.$mapPromise,u=new window.google.maps.LatLngBounds;c.value.forEach(T=>{u.extend(T.position)}),n.fitBounds(u)}A(i,()=>{i.value&&i.value.$mapPromise.then(()=>{l.value=!1})});const b=({count:n,position:u})=>new window.google.maps.Marker({label:{text:`${n}`,color:"white",fontWeight:"600"},position:u,zIndex:1e3+n}),k={zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,rotateControl:!0,fullscreenControl:!1,styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#202c3e"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{gamma:.01},{lightness:20},{weight:"1.39"},{color:"#ffffff"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{weight:"0.96"},{saturation:"9"},{visibility:"on"},{color:"#000000"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{lightness:30},{saturation:"9"},{color:"#00a287"}]},{featureType:"poi",elementType:"geometry",stylers:[{saturation:20}]},{featureType:"poi.park",elementType:"all",stylers:[{saturation:"-16"},{lightness:"6"},{gamma:"1.00"},{color:"#00a287"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{lightness:20},{saturation:-20},{visibility:"simplified"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:10},{saturation:-30},{visibility:"simplified"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#00846e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{saturation:25},{lightness:25},{weight:"0.01"}]},{featureType:"water",elementType:"all",stylers:[{lightness:-20},{color:"#041f20"}]}]};return(n,u)=>{const T=ee,v=S("GMapInfoWindow"),B=S("GMapMarker"),Y=S("GMapCluster"),oe=S("GMapMap");return s(),a(h,null,[l.value?(s(),a("div",Le,[p(T,{type:"rectangle",class:"md:h-[40svh] h-[30svh]"})])):x("",!0),!l.value&&n.hitsList.length===0?(s(),a("div",Se)):(s(),$(oe,Z({key:2},n.$attrs,{ref_key:"mapRef",ref:i,zoom:7,center:_.value,"map-type-id":"terrain",class:"grid-areas",options:k}),{default:C(()=>[p(Y,{renderer:{render:b},"zoom-on-click":!0},{default:C(()=>[(s(!0),a(h,null,D(c.value,(w,se)=>(s(),$(B,{key:se,position:w.position,clickable:!0,icon:{url:g(W)("icons/pin.png"),scaledSize:{width:30,height:30},labelOrigin:{x:16,y:-30}},onClick:E=>m(w.id)},{default:C(()=>[p(v,{closeclick:!0,opened:r.value===w.id,class:"px-8 py-8",onCloseclick:u[0]||(u[0]=E=>m(null))},{default:C(()=>{var E,H;return[t("ul",null,[t("li",null,[N(" From IP: "),t("span",De,f(w.ip),1)]),t("li",Me,f(w.hostname),1),t("li",Be,f(w.date),1),t("li",Ee,f(w.city)+", "+f(w.country),1),t("li",null," Lat: "+f(((E=w.position)==null?void 0:E.lat)||"")+", Lng: "+f(((H=w.position)==null?void 0:H.lng)||""),1)])]}),_:2},1032,["opened"])]),_:2},1032,["position","icon","onClick"]))),128))]),_:1},8,["renderer"])]),_:1},16,["center"]))],64)}}}),Oe=O(Ne,[["__scopeId","data-v-c30b6fcb"]]),je={class:"block text-xs uppercase text-grey-500"},R=I({__name:"IncidentDetailsListItem",props:{label:{},value:{type:[String,Boolean,Number]}},setup(e){function o(l){if(typeof l=="boolean")return l?"text-green":"text-red"}return(l,r)=>(s(),a("li",null,[t("span",je,f(l.label),1),t("span",{class:V(o(l.value))},f(l.value),3)]))}}),Pe={class:"p-16 text-white rounded-md bg-red"},Re=t("h2",{class:"font-semibold"},"Incident info",-1),Ve={class:"flex flex-col justify-between gap-24 mt-16 md:flex-row"},Ge={class:"flex flex-col gap-2"},ze=t("span",{class:"text-xs text-red-100"},"Date",-1),Ke={class:"font-semibold"},Ue={class:"flex flex-col gap-2"},We=t("span",{class:"text-xs text-red-100"},"IP",-1),Fe={class:"font-semibold"},Ye={class:"flex flex-col gap-2"},He=t("span",{class:"text-xs text-red-100"},"Channel",-1),Je={class:"font-semibold"},qe=I({__name:"IncidentDetailsSummary",props:{date:{},ip:{},inputChannel:{}},setup(e){return(o,l)=>(s(),a("section",Pe,[Re,t("ul",Ve,[t("li",Ge,[ze,t("span",Ke,f(o.date)+"Â ",1)]),t("li",Ue,[We,t("span",Fe,f(o.ip),1)]),t("li",Ye,[He,t("span",Je,f(o.inputChannel),1)])])]))}});function Xe(e,o){return q.hasOwnProperty(o)?q[o]:e}function Qe(e){return e.replace(/_/g," ").replace(/^(.)/,function(l,r){return r.toUpperCase()})}function z(e){try{return Object.entries(e).reduce((o,[l,r])=>{const i=J.hasOwnProperty(l)?J[l]:Qe(l);return typeof r=="object"&&r!==null?o[i]=z(r):o[i]=r,o},{})}catch(o){return console.error(`Error in formatting labels: ${o}`),e}}function Ze(e){const o=Object.values(F).find(l=>l===e);return o?G[o].label:e}function M(e){return typeof e=="object"&&e!==null?Array.isArray(e)?e.length>0:Object.values(e).some(o=>o!=null&&(typeof o!="object"||Object.keys(o).length>0)):e!=null}function Ae(e){return e===F.CREDIT_CARD}function et(e){return e===F.AWS_KEYS}function Q(e){try{return{time_of_hit:U(e.time_of_hit),src_ip:e.src_ip,geo_info:e.geo_info.bogon?{ip:e.geo_info.ip,bogon:e.geo_info.bogon}:{...e.geo_info},is_tor_relay:Ae(e.token_type)?null:e.is_tor_relay,basic_info:{token_type:Ze(e.token_type),input_channel:Xe(e.input_channel,e.token_type),src_data:e.src_data,useragent:e.useragent||null,last4:e.last4||null,amount:e.amount||null,merchant:e.merchant||null,mail:e.mail||null,referer:e.referer||null,location:e.location||null},additional_info:{...e.additional_info,aws_key_log_data:et(e.token_type)&&e.additional_info.aws_key_log_data?{last_used:e.additional_info.aws_key_log_data.last_used?new Date(Number(e.additional_info.aws_key_log_data.last_used)):null,service_used:e.additional_info.aws_key_log_data.service_used}:null}}}catch(o){return console.error(`Error in building the Incident Details object: ${o}`),e}}const tt=e=>(re("data-v-ebbfeaab"),e=e(),ce(),e),ot={class:"pb-32 m-4 bg-white rounded-md"},st={class:"sticky top-[0px] bg-white h-[4vh] flex justify-end"},nt={class:"px-16"},lt={class:"grid md:grid-cols-[auto_1fr] gap-32 mt-32 pl-8"},at={key:0,class:"text-grey-500"},it={key:1,class:"flex flex-col gap-16 pb-16 [&:not(:last-child)]:border-b md:ml-32 border-grey-100"},rt={key:0,class:"break-words"},ct={class:"text-grey-500"},ut=tt(()=>t("div",{class:"border-b border-grey-100"},null,-1)),dt=I({__name:"IncidentDetails",props:{hitAlert:{}},emits:["close"],setup(e,{emit:o}){const l=e,r=o,i=y(null),_=y({});return K(()=>{i.value=Q(l.hitAlert),_.value=z(i.value)}),A(()=>l.hitAlert,()=>{i.value=Q(l.hitAlert),_.value=z(i.value)}),(d,c)=>{var L;const m=S("font-awesome-icon");return s(),a("div",ot,[t("div",st,[t("button",{type:"button",class:"px-16",onClick:c[0]||(c[0]=b=>r("close"))},[p(m,{icon:"xmark",class:"w-6 h-6 text-grey-400 hover:text-grey-200"})])]),t("div",nt,[i.value?(s(),$(qe,{key:0,date:(L=i.value)==null?void 0:L.time_of_hit,ip:i.value.src_ip,"input-channel":i.value.basic_info.input_channel},null,8,["date","ip","input-channel"])):x("",!0),t("section",lt,[(s(!0),a(h,null,D(_.value,(b,k)=>(s(),a(h,{key:k},[g(M)(k)&&g(M)(b)?(s(),a("h3",at,f(k)+": ",1)):x("",!0),g(M)(b)?(s(),a("ul",it,[g(j)(b)?(s(!0),a(h,{key:1},D(b,(n,u)=>(s(),a(h,{key:u},[g(M)(n)?(s(),a("ul",rt,[g(j)(n)?(s(),a(h,{key:1},[t("ul",null,[t("h3",ct,f(u)+":",1),(s(!0),a(h,null,D(n,(T,v)=>(s(),a(h,{key:v},[!g(j)(n)&&g(M)(T)?(s(),$(R,{key:0,label:v,value:T,class:"py-8 ml-24"},null,8,["label","value"])):x("",!0)],64))),128))]),ut],64)):(s(),$(R,{key:0,label:u,value:n},null,8,["label","value"]))])):x("",!0)],64))),128)):(s(),$(R,{key:0,value:b},null,8,["value"]))])):x("",!0)],64))),128))])])])}}}),pt=O(dt,[["__scopeId","data-v-ebbfeaab"]]),_t={class:"flex flex-row flex-wrap items-center justify-between px-16 py-8 mb-8 bg-white rounded-xl shadow-solid-shadow-grey border border-grey-100"},ft=t("p",{class:"text-sm text-grey-500"},"Download list",-1),mt={class:"flex flex-row"},ht=I({__name:"AlertsListDownload",setup(e){const o=te(),l=y(!1),r=y(!1);function i(_){_===P.CSV?l.value=!0:r.value=!0;const d={fmt:_,auth:o.params.auth,token:o.params.token};ue(d).then(c=>{window.location.href=c.request.responseURL}).catch(c=>{console.log(c,"err")}).finally(()=>{l.value=!1,r.value=!1,console.log("You downloaded the file, yay!")})}return(_,d)=>{const c=de;return s(),a("li",_t,[ft,t("div",mt,[p(c,{variant:"text",icon:"file",loading:l.value,onClick:d[0]||(d[0]=m=>i(g(P).CSV))},{default:C(()=>[N("CSV")]),_:1},8,["loading"]),p(c,{variant:"text",icon:"file-excel",loading:r.value,onClick:d[1]||(d[1]=m=>i(g(P).JSON))},{default:C(()=>[N("JSON")]),_:1},8,["loading"])])])}}}),yt={class:"flex flex-col gap-16 mx-16 mt-[60px]"},gt={class:"flex flex-col gap-16 mt-[60px]"},vt={class:"flex flex-col h-full gap-16 pb-16"},xt=t("h2",{class:"font-semibold leading-5 text-grey-800"},"Alerts list",-1),bt={key:0,class:"flex flex-col items-center justify-center flex-grow px-16 py-16 align-middle"},kt=t("p",{class:"text-xl text-center text-grey-400"}," There are no alerts for this Canarytoken. ",-1),wt=["src"],$t=I({__name:"HistoryToken",emits:["update-token-title"],setup(e,{emit:o}){const l=o,r=te(),i=pe(),_=y(!1),d=y(null),c=y(),m=y();K(async()=>{await L()});async function L(){_.value=!0;const k={auth:r.params.auth,token:r.params.token};try{const u=await(await _e(k)).data;c.value=u.history.hits,l("update-token-title",u.history.token_type,r.params.token)}catch(n){console.log(n,"err!"),d.value=n.toString(),i.push({name:"error"})}finally{_.value=!1}}function b(k){m.value=k;const n=document.getElementById("incident_detail");n?n.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}return(k,n)=>{const u=ee,T=me;return s(),a(h,null,[_.value?(s(),a(h,{key:0},[t("div",yt,[p(u,{type:"header",class:"w-[200px]"}),p(u,{class:"h-[10vh]"}),p(u,{class:"h-[10vh]"}),p(u,{class:"h-[10vh]"})]),t("div",gt,[p(u,{class:"h-[50svh] w-full"}),p(u,{class:"h-[20svh] w-full"})])],64)):x("",!0),d.value?(s(),$(T,{key:1,variant:"danger",message:"Oh no! Something went wrong. Please refresh the page or try again later."})):x("",!0),c.value?(s(),a(h,{key:2},[t("div",{id:"alerts-card-list",class:V(["flex-col md:p-16 md:bg-grey-50 md:rounded-xl md:overflow-scroll md:max-h-[70svh]",{"hidden md:block":m.value}])},[t("ul",vt,[xt,c.value.length===0?(s(),a("li",bt,[kt,t("img",{src:g(W)("token_icons/default.png"),alt:"No alerts",class:"grayscale opacity-50 w-[50%] not-sr-only group-hover:opacity-100 sm:block mt-16"},null,8,wt)])):(s(),$(ht,{key:1})),(s(!0),a(h,null,D(c.value,(v,B)=>(s(),$(Ie,{key:B,"last-key":B===c.value.length-1,"incident-id":v.time_of_hit,"incident-preview-info":{Date:g(U)(v.time_of_hit),IP:v.src_ip,Channel:v.input_channel},onClick:Y=>b(v)},null,8,["last-key","incident-id","incident-preview-info","onClick"]))),128)),p(X,{class:"flex sm:hidden"})])],2),t("div",null,[t("div",{class:V(["@md:relative md:h-[45svh] h-[30svh]",c.value.length===0?"hidden sm:grid":"grid"])},[p(fe,{name:"slide-fade"},{default:C(()=>[m.value?(s(),$(pt,{key:0,id:"incident_detail","hit-alert":m.value,class:"absolute top-[80px] left-[0] md:top-[0px] md:relative grid-areas z-10 md:overflow-scroll",onClose:n[0]||(n[0]=v=>m.value=null)},null,8,["hit-alert"])):x("",!0)]),_:1}),p(Oe,{"hits-list":c.value},null,8,["hits-list"])],2),p(X,{class:"hidden sm:flex"})])],64)):x("",!0)],64)}}}),Tt={key:0,class:"flex flex-col items-center gap-8 mt-16"},Ct=["src","alt"],It={class:"mb-24 text-xl text-center text-grey-500"},Lt={class:"text-grey-300"},St={class:"font-semibold"},Bt=I({__name:"HistoryView",setup(e){const o=y(""),l=y(""),r=y("");function i(_,d){o.value=G[_].label,r.value=W(`token_icons/${G[_].icon}`),l.value=d}return(_,d)=>(s(),a(h,null,[o.value&&l.value&&r.value?(s(),a("div",Tt,[t("img",{src:r.value,class:"h-[4rem]","aria-hidden":"true",alt:`${o.value} logo`},null,8,Ct),t("div",It,[t("h2",null,[t("span",Lt,f(o.value)+" Canarytoken ID: ",1),t("span",St,f(l.value),1)])])])):x("",!0),p(ve,null,{default:C(()=>[p($t,{onUpdateTokenTitle:d[0]||(d[0]=(c,m)=>i(c,m))})]),_:1})],64))}});export{Bt as default};
